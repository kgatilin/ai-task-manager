# Refreshed by go-arch-lint refresh with preset=ddd
# Previous config backed up to .goarchlint.backup
# You can customize the error_prompt section to fit your project's needs

module: github.com/kgatilin/darwinflow-pub
preset_used: ddd
error_prompt:
    enabled: true
    architectural_goals: |4
        Domain-Driven Design (DDD) architecture aims to:
        - Keep business logic pure and isolated in the domain layer
        - Prevent infrastructure concerns from leaking into business logic
        - Enable the domain model to evolve independently of technical implementation
        - Make the business logic testable without external dependencies
    principles:
        - Domain layer has ZERO dependencies - it's the purest business logic
        - Application layer orchestrates domain objects and use cases
        - Infrastructure layer implements technical details (databases, APIs, messaging)
        - 'Dependencies flow inward: cmd → infra/app → domain (never outward)'
        - Domain should never import from app or infra layers
    refactoring_guidance: |4
        To refactor toward DDD compliance:

        1. **Move business logic to domain layer**: Extract pure business rules, validation, and domain services to internal/domain
        2. **Define domain interfaces in domain layer**: If domain needs external capabilities (repositories, messaging), define interfaces in domain, implement in infra
        3. **Use dependency injection**: Pass infrastructure implementations to application layer through constructors, never import directly
        4. **Extract use cases to app layer**: Orchestration logic that coordinates multiple domain objects belongs in internal/app
        5. **Keep domain pure**: Domain should only import Go stdlib, never other project packages

        Example refactoring:
        - Before: internal/domain/user.go imports internal/infra/database
        - After: internal/domain/user.go defines UserRepository interface, internal/infra/postgres.go implements it
structure:
    required_directories:
        cmd: Application entry points
        internal/app: Application services, use cases, orchestration
        internal/domain: Core business logic, entities, value objects, domain services
        internal/infra: Infrastructure implementations (DB, external APIs, messaging)
    allow_other_directories: true
rules:
    directories_import:
        cmd:
            - internal/app
            - internal/infra
        internal/app:
            - internal/domain
        internal/domain: []
        internal/infra:
            - internal/domain
    detect_unused: true
    shared_external_imports:
        detect: true
        mode: warn
        exclusions:
            - fmt
            - strings
            - errors
            - time
            - context
        exclusion_patterns:
            - encoding/*
    test_files:
        lint: true
        exempt_imports:
            - testing
            - github.com/stretchr/testify/assert
            - github.com/stretchr/testify/require
            - github.com/stretchr/testify/mock
